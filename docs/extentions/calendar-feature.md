# 9. 달력 기능 명세서 (Calendar Feature Specification)

## 문서 정보

**문서 버전**: 1.0
**작성일**: 2025-11-27
**상태**: 확장 기능 (Extension)
**관련 문서**: [PRD](./2-prd-product-requirements.md), [Implementation Plan](./7-implementation_plan.md)

---

## 1. 개요

### 1.1 기능 목표

달력 뷰를 통해 할일을 시각적으로 관리하고, 국경일 정보를 함께 표시하여 사용자의 일정 관리 효율성을 극대화한다.

### 1.2 핵심 기능

1. **월간 달력 뷰**: 현재 월의 달력에 할일과 국경일 표시
2. **날짜별 할일 표시**: 각 날짜에 해당하는 할일 개수 및 미리보기
3. **인터랙션**: 달력에서 직접 할일 생성, 수정, 완료, 삭제
4. **국경일 표시**: DB에 저장된 국경일 정보 표시

### 1.3 국경일 API 연동

**API 제공**: 한국천문연구원 (KASI) 특일 정보 제공 서비스

**API 키**: `18ea54df0b7fb1a213f35c5c200ea36433a9eed33d1d8c9585a7f10c6e54a33e`

**상세 문서**: [KASI API 연동 가이드](./10-kasi-api-integration.md)

**주요 기능**:

- 연간/월간 특일 정보 조회
- 국경일, 기념일, 24절기 정보 제공
- DB 자동 동기화

---

## 2. 사용자 시나리오

### 시나리오 1: 월간 일정 확인

**배경**: 사용자가 이번 달 전체 일정을 한눈에 파악하고 싶다.

**단계**:

1. 사용자가 "달력" 메뉴 클릭
2. 현재 월의 달력이 표시됨
3. 각 날짜에 할일 개수와 국경일이 표시됨
4. 마감일이 임박한 날짜는 강조 표시

**결과**: 한 달 전체 일정을 시각적으로 파악하여 업무 계획 수립

### 시나리오 2: 특정 날짜 할일 관리

**배경**: 사용자가 특정 날짜의 할일을 확인하고 새로운 할일을 추가하고 싶다.

**단계**:

1. 달력에서 특정 날짜 클릭
2. 해당 날짜의 할일 목록이 사이드 패널에 표시됨
3. "할일 추가" 버튼 클릭
4. 모달에서 제목, 내용 등 입력 (날짜는 선택한 날짜로 자동 설정)
5. 저장 시 달력에 즉시 반영

**결과**: 날짜별로 할일을 쉽게 추가하고 관리

### 시나리오 3: 국경일 확인

**배경**: 사용자가 이번 달 공휴일을 확인하고 싶다.

**단계**:

1. 달력에서 국경일이 있는 날짜 확인 (예: 빨간색으로 표시)
2. 국경일 날짜 위에 마우스 호버
3. 툴팁으로 국경일 이름 표시 (예: "설날")

**결과**: 공휴일을 고려한 일정 계획 수립

---

## 3. 기능 요구사항

### 3.1 달력 UI

#### 3.1.1 월간 달력 뷰

**필수 요소**:

- 현재 월/년도 표시
- 이전/다음 달 네비게이션
- 요일 헤더 (일요일~토요일)
- 날짜 셀 (6주 표시)

**각 날짜 셀 표시 정보**:

- 날짜 숫자
- 할일 개수 (예: "3개")
- 할일 상태 표시 (점 또는 배지)
- 국경일 이름 (있는 경우)

#### 3.1.2 날짜 셀 스타일

**상태별 스타일**:

- 오늘: 파란색 테두리
- 국경일: 빨간색 텍스트
- 할일 있음: 배지 표시
- 마감일 임박(3일 이내): 주황색 강조
- 과거 날짜: 회색 (비활성)

#### 3.1.3 날짜 클릭 시

**동작**:

1. 해당 날짜의 할일 목록을 사이드 패널에 표시
2. "할일 추가" 버튼 활성화 (해당 날짜로 자동 설정)
3. 기존 할일 클릭 시 수정 모달 열기

### 3.2 백엔드 API

#### 3.2.1 달력 데이터 조회 API

**엔드포인트**: `GET /api/calendar/{year}/{month}`

**요청 파라미터**:

- `year`: 연도 (YYYY)
- `month`: 월 (1~12)

**응답 데이터**:

```json
{
  "success": true,
  "data": {
    "year": 2025,
    "month": 11,
    "todos": [
      {
        "id": 1,
        "title": "프로젝트 기획",
        "due_date": "2025-11-27",
        "is_completed": false,
        "priority": "HIGH"
      }
    ],
    "publicEvents": [
      {
        "id": 1,
        "event_name": "크리스마스",
        "event_date": "2025-12-25",
        "is_holiday": true
      }
    ]
  }
}
```

#### 3.2.2 기존 API 활용

- 할일 생성: `POST /api/todos`
- 할일 수정: `PATCH /api/todos/:id`
- 할일 삭제: `DELETE /api/todos/:id`
- 할일 완료 토글: `PATCH /api/todos/:id` (is_completed 업데이트)

### 3.3 국경일 기능

#### 3.3.1 DB 데이터 활용

**현재 상태**:

- `public_events` 테이블에 2025년 한국 공휴일 데이터 저장됨
- 총 20개의 공휴일 데이터 포함

**조회 방식**:

- 달력 데이터 조회 API에서 함께 반환
- 월별로 필터링하여 반환

#### 3.3.2 향후 확장 (API 연동)

**계획**:

- 국경일 API 연동 (향후 구현)
- 자동 업데이트 및 동기화
- 부족한 데이터 자동 보완

---

## 4. 기술 명세

### 4.1 프론트엔드

#### 4.1.1 달력 라이브러리

**추천 라이브러리**: `react-calendar`

**선정 이유**:

- 간단하고 가볍다
- 커스터마이징 용이
- TypeScript 지원
- 한국어 로케일 지원

**설치**:

```bash
npm install react-calendar
npm install date-fns  # 날짜 유틸리티 (이미 설치됨)
```

#### 4.1.2 컴포넌트 구조

```
CalendarPage/
├── CalendarView       # 달력 메인 뷰
├── DayCell            # 각 날짜 셀
├── TodoSidebar        # 선택한 날짜의 할일 목록
└── CalendarHeader     # 월/년도 헤더 및 네비게이션
```

#### 4.1.3 State 관리

**Zustand Store 확장**:

```javascript
// useCalendarStore.js
{
  currentDate: Date,        // 현재 선택된 날짜
  viewMonth: { year, month }, // 보고 있는 월
  calendarTodos: [],        // 해당 월의 모든 할일
  publicEvents: [],         // 해당 월의 국경일
  selectedDate: Date,       // 사이드바에 표시할 날짜
}
```

### 4.2 백엔드

#### 4.2.1 새 Repository 메서드

```javascript
// calendarRepository.js
-getTodosByMonth(userId, year, month) - getPublicEventsByMonth(year, month);
```

#### 4.2.2 새 Service 메서드

```javascript
// calendarService.js
-getCalendarData(userId, year, month);
```

#### 4.2.3 새 Controller & Routes

```javascript
// calendarController.js
- getCalendarData(req, res)

// calendarRoutes.js
GET /api/calendar/:year/:month
```

---

## 5. UI/UX 디자인

### 5.1 레이아웃

```
┌─────────────────────────────────────────────────────────────┐
│ [로고] JKN-TODOLIST        2025년 11월  [◀] [▶]    [로그아웃] │
├──────────┬──────────────────────────────────────────────────┤
│ 할일목록  │         일  월  화  수  목  금  토                │
│ 달력 ✓   │      27  28  29  30  31   1   2                 │
│ 휴지통   │       3   4   5   6   7   8   9                 │
│          │      10  11  12  13  14  15  16                 │
│          │      17  18  19  20  21  22  23                 │
│          │      24  25  26 [27]  28  29  30                │
│          │       1   2   3   4   5   6   7                 │
│          │                                                  │
│          │ 2025-11-27 (수)                                  │
│          │ ┌──────────────────────────────────────────────┐ │
│          │ │ ☐ 프로젝트 발표 준비  [높음]                  │ │
│          │ │ ☑ 회의록 작성 (완료)                          │ │
│          │ └──────────────────────────────────────────────┘ │
│          │ [+ 할일 추가]                                     │
└──────────┴──────────────────────────────────────────────────┘
```

### 5.2 색상 가이드

- 오늘: 파란색 테두리 (#3B82F6)
- 국경일: 빨간색 텍스트 (#EF4444)
- 할일 있음: 작은 파란색 점
- 마감 임박: 주황색 배경 (#F59E0B)
- 과거: 회색 (#9CA3AF)

---

## 6. 개발 순서

### Phase 1: 백엔드 API (BE-06)

1. CalendarRepository 생성
2. CalendarService 생성
3. CalendarController & Routes 생성
4. 통합 테스트 작성

### Phase 2: 달력 UI (FE-08)

1. react-calendar 설치 및 기본 설정
2. CalendarPage 컴포넌트 생성
3. 월별 데이터 조회 API 연동
4. 날짜 셀 커스터마이징 (할일 표시)

### Phase 3: 인터랙션 (FE-09)

1. 날짜 클릭 시 사이드바 표시
2. 사이드바에서 할일 추가/수정/삭제
3. 달력 실시간 업데이트

### Phase 4: 국경일 표시 (FE-10)

1. 국경일 데이터 표시
2. 국경일 스타일링
3. 툴팁 추가

---

## 7. 인수 조건

### 백엔드

- [ ] 달력 데이터 조회 API 구현
- [ ] 해당 월의 할일 및 국경일 반환
- [ ] 통합 테스트 통과

### 프론트엔드

- [ ] 월간 달력 뷰 표시
- [ ] 날짜별 할일 표시 (배지/점)
- [ ] 날짜 클릭 시 사이드바 표시
- [ ] 사이드바에서 할일 CRUD 가능
- [ ] 국경일 표시 (빨간색)
- [ ] 이전/다음 달 네비게이션

---

## 8. 향후 확장

### 8.1 국경일 API 연동

- 공공 데이터 포털 API 활용
- 자동 동기화 기능
- 누락된 데이터 자동 업데이트

### 8.2 추가 기능

- 주간 뷰 / 일간 뷰
- 드래그 앤 드롭으로 할일 날짜 변경
- 달력 내보내기 (iCal 형식)
- 알림 기능
