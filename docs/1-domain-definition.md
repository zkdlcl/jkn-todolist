# JKN-TODOLIST 도메인 정의서

## 1. 비즈니스 개요

**프로젝트명**: JKN-TODOLIST

**목적**: 사용자별로 개인 할일과 공통 일정을 통합 관리할 수 있는 인증 기반 할일 관리 애플리케이션

**핵심 가치**:
- 개인화된 할일 관리
- 일정 기반 작업 추적
- 삭제 복구 기능을 통한 데이터 안전성
- 공통 일정 공유를 통한 일정 통합 관리

## 2. 도메인 모델

### 2.1 핵심 엔티티

#### User (사용자)
개별 사용자 계정을 나타내는 엔티티

**주요 속성**:
- 사용자 ID (고유 식별자)
- 이메일 (로그인 ID)
- 비밀번호 (암호화 저장: bcrypt, 최소 10 rounds)
- 사용자명
- 역할 (ROLE_USER / ROLE_ADMIN)
- 가입 일시
- 마지막 로그인 일시
- 계정 상태 (활성/비활성)
- 리프레시 토큰 (암호화 저장)
- 리프레시 토큰 만료 일시

**관계**:
- 다수의 Todo를 소유 (1:N)

**비즈니스 규칙**: REQ-USER-001 ~ REQ-USER-005 참조

---

#### Todo (할일)
사용자가 관리하는 개별 할일 항목 (개인 할일만 해당)

**주요 속성**:
- 할일 ID (고유 식별자)
- 제목 (필수, 최대 200자)
- 상세 내용 (선택, 최대 2000자)
- 시작 일시
- 만료 일시
- 완료 여부 (true/false)
- 완료 일시
- 우선순위 (LOW=1, MEDIUM=2, HIGH=3)
- 소유자 ID (사용자 참조, 필수)
- 생성 일시
- 수정 일시
- 삭제 상태 (ACTIVE / DELETED)
- 삭제 일시

**관계**:
- User에 속함 (N:1)

**비즈니스 규칙**: REQ-TODO-001 ~ REQ-TODO-010 참조

---

#### RecycleBin (휴지통)
**설계 결정**: RecycleBin은 별도 테이블이 아닌, Todo 테이블의 deleted_status='DELETED' 상태로 구현

**삭제 메커니즘**:
- 소프트 삭제: Todo.deleted_status를 'ACTIVE'에서 'DELETED'로 변경
- 휴지통 조회: deleted_status='DELETED'인 Todo 목록 조회
- 복구: deleted_status를 'DELETED'에서 'ACTIVE'로 변경
- 영구 삭제: Todo 레코드를 데이터베이스에서 물리적 삭제

**비즈니스 규칙**: REQ-RECYCLE-001 ~ REQ-RECYCLE-004 참조

---

#### PublicHoliday (공통 일정)
**설계 결정**: PublicHoliday는 Todo와 별개의 독립 엔티티로 구현 (ADR-001 참조)

시스템 관리자(ROLE_ADMIN)가 관리하는 공통 일정 (예: 국경일)

**주요 속성**:
- 일정 ID (고유 식별자)
- 일정명 (예: "설날", "추석")
- 일정 날짜
- 일정 유형 (NATIONAL_HOLIDAY, PUBLIC_HOLIDAY, MEMORIAL_DAY)
- 반복 여부 (매년 반복)
- 생성 일시
- 생성자 (관리자 ID)

**관계**:
- 독립 테이블 (Todo와 별개)
- 조회 시 애플리케이션 레벨에서 Todo와 통합 표시

**비즈니스 규칙**: REQ-HOLIDAY-001 ~ REQ-HOLIDAY-005 참조

---

### 2.2 관리자 역할 정의

**관리자 (ROLE_ADMIN)**:
- 공통 일정(PublicHoliday) 생성, 수정, 삭제 권한
- 사용자 계정 관리 권한 (향후 확장)
- 일반 사용자 권한 포함 (자신의 Todo 관리 가능)

**일반 사용자 (ROLE_USER)**:
- 자신의 Todo 생성, 조회, 수정, 삭제
- 공통 일정 조회 (읽기 전용)
- 자신의 휴지통 관리

---

## 3. 비즈니스 규칙

### 3.1 사용자 관리

**REQ-USER-001**: 이메일 형식 검증
- RFC 5322 표준 준수
- 예: user@example.com
- 최대 길이 100자

**REQ-USER-002**: 비밀번호 정책
- 최소 8자, 최대 50자
- 대문자 최소 1개
- 소문자 최소 1개
- 숫자 최소 1개
- 특수문자 최소 1개 (!@#$%^&*)

**REQ-USER-003**: 중복 이메일 가입 불가
- 동일한 이메일로 이미 가입된 계정이 있으면 가입 실패
- 에러 메시지: "이미 사용 중인 이메일입니다"

**REQ-USER-004**: 역할 할당
- 회원가입 시 기본 역할은 ROLE_USER
- ROLE_ADMIN은 시스템 관리자가 수동으로 부여

**REQ-USER-005**: 비밀번호 암호화
- bcrypt 알고리즘 사용
- 최소 10 rounds (보안 강도)

---

### 3.2 인증 및 권한

**REQ-AUTH-001**: JWT 기반 인증
- Access Token과 Refresh Token 사용
- Stateless 인증 방식

**REQ-AUTH-002**: Access Token 정책
- 유효 기간: 15분
- JWT Payload: user_id, email, role, exp, iat
- 알고리즘: HS256 (HMAC with SHA-256)

**REQ-AUTH-003**: Refresh Token 정책
- 유효 기간: 7일
- 데이터베이스에 암호화하여 저장
- 일회용: 사용 시 새로운 토큰 발급 후 기존 토큰 무효화

**REQ-AUTH-004**: 로그인 실패 처리
- 잘못된 이메일 또는 비밀번호 시 동일한 에러 메시지
- 에러 메시지: "이메일 또는 비밀번호가 올바르지 않습니다"
- 보안상 이유로 이메일 존재 여부를 구분하여 노출하지 않음

**REQ-AUTH-005**: 접근 권한
- 인증된 사용자만 할일 관리 기능 접근 가능
- 사용자는 자신의 할일만 조회/수정/삭제 가능
- 공통 일정은 모든 인증된 사용자가 조회 가능
- 공통 일정의 수정/삭제는 ROLE_ADMIN만 가능

---

### 3.3 할일 관리

**REQ-TODO-001**: 제목 필수 입력
- 제목은 필수 항목
- 최소 1자, 최대 200자
- 빈 문자열 또는 공백만 입력 불가

**REQ-TODO-002**: 만료 일시 검증
- 만료 일시는 시작 일시보다 이후여야 함
- 검증 계층: 프론트엔드 + 백엔드 API
- 에러 메시지: "만료 일시는 시작 일시 이후여야 합니다"

**REQ-TODO-003**: 기본값 설정
- 우선순위 기본값: MEDIUM (2)
- 완료 여부 기본값: false
- 삭제 상태 기본값: ACTIVE

**REQ-TODO-004**: 할일 조회
- 로그인한 사용자의 개인 할일만 조회
- deleted_status='ACTIVE'인 할일만 표시
- 필터링: 완료/미완료, 기간별, 우선순위별
- 정렬: 만료 일시, 생성 일시, 우선순위

**REQ-TODO-005**: 할일 수정
- 소유자만 자신의 할일 수정 가능
- 수정 시 updated_at 자동 갱신
- 다른 사용자의 할일 수정 시도 시 403 Forbidden

**REQ-TODO-006**: 할일 완료 처리
- 완료 상태로 전환 시 completed_at 자동 기록
- 완료 취소 시 completed_at null로 설정
- 완료된 할일도 목록에서 조회 가능

**REQ-TODO-007**: 소유자 검증
- Todo의 owner_id와 현재 로그인 사용자 ID 일치 여부 검증
- 불일치 시 403 Forbidden 응답

**REQ-TODO-008**: 상세 내용 길이 제한
- 상세 내용은 선택 항목
- 최대 2000자

**REQ-TODO-009**: 우선순위 값 검증
- 허용 값: LOW(1), MEDIUM(2), HIGH(3)
- 그 외 값 입력 시 400 Bad Request

**REQ-TODO-010**: 날짜 형식
- ISO 8601 형식 사용 (YYYY-MM-DDTHH:mm:ss.sssZ)
- 예: 2025-11-25T14:30:00.000Z

---

### 3.4 삭제 및 복구

**REQ-RECYCLE-001**: 소프트 삭제
- 할일 삭제 시 deleted_status를 'DELETED'로 변경
- deleted_at에 현재 일시 기록
- 물리적 삭제 없음 (데이터 보존)

**REQ-RECYCLE-002**: 휴지통 조회
- 소유자만 자신의 휴지통 조회 가능
- deleted_status='DELETED'인 할일만 표시
- deleted_at 기준 내림차순 정렬

**REQ-RECYCLE-003**: 복구
- 휴지통의 할일을 복구 시 deleted_status를 'ACTIVE'로 변경
- deleted_at을 null로 설정
- 원본 속성 유지 (제목, 내용, 날짜 등)

**REQ-RECYCLE-004**: 영구 삭제
- 휴지통의 할일을 데이터베이스에서 물리적 삭제
- 복구 불가능
- 삭제 확인 메시지: "영구 삭제된 할일은 복구할 수 없습니다. 계속하시겠습니까?"

---

### 3.5 공통 일정 관리

**REQ-HOLIDAY-001**: 공통 일정 조회
- 모든 인증된 사용자가 조회 가능
- 할일 목록과 통합하여 표시
- 시각적 구분 (배지, 색상 등)

**REQ-HOLIDAY-002**: 공통 일정 생성
- ROLE_ADMIN만 생성 가능
- 일반 사용자(ROLE_USER) 생성 시도 시 403 Forbidden
- 필수 항목: 일정명, 일정 날짜, 일정 유형

**REQ-HOLIDAY-003**: 공통 일정 수정/삭제
- ROLE_ADMIN만 수정/삭제 가능
- 일반 사용자 시도 시 403 Forbidden
- 에러 메시지: "공통 일정은 관리자만 수정/삭제할 수 있습니다"

**REQ-HOLIDAY-004**: 반복 일정
- 매년 반복 여부 설정 가능
- 반복 일정은 자동으로 다음 해에 생성 (향후 구현)

**REQ-HOLIDAY-005**: 일정 유형
- 허용 값: NATIONAL_HOLIDAY, PUBLIC_HOLIDAY, MEMORIAL_DAY
- 그 외 값 입력 시 400 Bad Request

---

## 4. 사용자 스토리

### 4.1 인증 관련

**US-001: 회원가입**
- **As a** 신규 사용자
- **I want to** 이메일과 비밀번호로 회원가입
- **So that** 개인 할일 목록을 관리할 수 있다

**인수 조건**:
- 유효한 이메일 형식 입력
- 비밀번호 요구사항 충족
- 중복 이메일 검증
- 가입 성공 시 자동 로그인 또는 로그인 페이지로 이동

---

**US-002: 로그인**
- **As a** 등록된 사용자
- **I want to** 이메일과 비밀번호로 로그인
- **So that** 내 할일 목록에 접근할 수 있다

**인수 조건**:
- 유효한 인증 정보로 로그인 성공
- 잘못된 인증 정보 시 오류 메시지 표시
- 로그인 성공 시 인증 토큰 발급
- 로그인 상태 유지

---

### 4.2 할일 관리

**US-003: 할일 목록 조회**
- **As a** 로그인한 사용자
- **I want to** 내 할일 목록을 조회
- **So that** 현재 진행 중인 작업을 확인할 수 있다

**인수 조건**:
- 개인 할일 목록 표시
- 공통 일정 함께 표시
- 완료/미완료 상태 시각적 구분
- 만료 임박 할일 강조

---

**US-004: 할일 추가**
- **As a** 로그인한 사용자
- **I want to** 새로운 할일을 추가
- **So that** 작업을 추적하고 관리할 수 있다

**인수 조건**:
- 제목 입력 필수
- 상세 내용 입력 선택
- 시작 일시와 만료 일시 설정
- 우선순위 선택
- 추가된 할일이 목록에 즉시 표시

---

**US-005: 할일 수정**
- **As a** 로그인한 사용자
- **I want to** 기존 할일을 수정
- **So that** 변경된 정보를 반영할 수 있다

**인수 조건**:
- 모든 할일 속성 수정 가능
- 수정 즉시 목록에 반영
- 수정 일시 자동 갱신

---

**US-006: 할일 완료 처리**
- **As a** 로그인한 사용자
- **I want to** 완료한 할일을 완료 상태로 변경
- **So that** 진행 상황을 추적할 수 있다

**인수 조건**:
- 완료 상태로 전환
- 완료 표시 시각적 변경
- 완료 취소 가능

---

**US-007: 할일 삭제 (휴지통 이동)**
- **As a** 로그인한 사용자
- **I want to** 불필요한 할일을 삭제
- **So that** 목록을 깔끔하게 유지할 수 있다

**인수 조건**:
- 개인 할일만 삭제 가능
- 삭제 시 휴지통으로 이동
- 할일 목록에서 제거
- 삭제 확인 메시지 표시

---

### 4.3 휴지통 관리

**US-008: 휴지통 조회**
- **As a** 로그인한 사용자
- **I want to** 삭제된 할일을 휴지통에서 조회
- **So that** 삭제된 항목을 확인하고 복구할 수 있다

**인수 조건**:
- 내가 삭제한 할일만 표시
- 삭제 일시 표시
- 복구 및 영구 삭제 옵션 제공

---

**US-009: 할일 복구**
- **As a** 로그인한 사용자
- **I want to** 휴지통의 할일을 복구
- **So that** 실수로 삭제한 할일을 되돌릴 수 있다

**인수 조건**:
- 휴지통에서 선택한 할일 복구
- 복구된 할일이 목록에 다시 표시
- 원본 데이터 유지

---

**US-010: 할일 영구 삭제**
- **As a** 로그인한 사용자
- **I want to** 휴지통의 할일을 영구 삭제
- **So that** 불필요한 데이터를 완전히 제거할 수 있다

**인수 조건**:
- 영구 삭제 확인 메시지 표시
- 삭제 후 복구 불가
- 휴지통에서 제거

---

### 4.4 공통 일정

**US-011: 공통 일정 조회**
- **As a** 로그인한 사용자
- **I want to** 국경일 같은 공통 일정을 함께 조회
- **So that** 개인 일정과 공휴일을 통합 관리할 수 있다

**인수 조건**:
- 할일 목록에 공통 일정 표시
- 공통 일정과 개인 할일 시각적 구분
- 공통 일정은 수정/삭제 불가 표시

---

**US-012: 공통 일정 삭제 제한**
- **As a** 로그인한 사용자
- **I want to** 공통 일정을 삭제할 수 없도록 제한
- **So that** 시스템 전체의 일관성을 유지할 수 있다

**인수 조건**:
- 공통 일정 삭제 시도 시 오류 메시지
- 삭제 버튼 비활성화 또는 숨김

---

## 5. 주요 유스케이스

### 5.1 UC-001: 사용자 등록 및 로그인

**액터**: 신규/기존 사용자

**사전 조건**: 없음

**주요 흐름**:
1. 사용자가 회원가입 페이지 접근
2. 이메일, 비밀번호, 사용자명 입력
3. 시스템이 입력 정보 유효성 검증
4. 시스템이 사용자 계정 생성
5. 사용자가 로그인 페이지로 이동
6. 이메일과 비밀번호로 로그인
7. 시스템이 인증 토큰 발급
8. 할일 목록 페이지로 이동

**대안 흐름**:
- 3a. 유효하지 않은 입력: 오류 메시지 표시 및 재입력 요청
- 6a. 잘못된 인증 정보: 로그인 실패 메시지 표시

**사후 조건**: 사용자가 인증되고 할일 관리 기능 접근 가능

---

### 5.2 UC-002: 할일 생성 및 관리

**액터**: 로그인한 사용자

**사전 조건**: 사용자가 인증됨

**주요 흐름**:
1. 사용자가 할일 목록 페이지 접근
2. 시스템이 사용자의 할일 목록과 공통 일정 표시
3. 사용자가 "새 할일 추가" 선택
4. 제목, 내용, 시작/만료 일시, 우선순위 입력
5. 시스템이 할일 생성 및 저장
6. 목록에 새 할일 추가 표시
7. 사용자가 할일 선택하여 상세 조회
8. 사용자가 할일 수정 또는 완료 처리
9. 시스템이 변경사항 저장 및 반영

**대안 흐름**:
- 4a. 필수 정보 누락: 오류 메시지 표시
- 4b. 만료 일시가 시작 일시보다 이전: 유효성 오류

**사후 조건**: 할일이 생성되고 목록에 표시됨

---

### 5.3 UC-003: 할일 삭제 및 복구

**액터**: 로그인한 사용자

**사전 조건**: 사용자가 인증되고 할일이 존재함

**주요 흐름**:
1. 사용자가 할일 목록에서 할일 선택
2. 삭제 옵션 선택
3. 시스템이 삭제 확인 요청
4. 사용자가 삭제 확인
5. 시스템이 할일을 휴지통으로 이동
6. 할일 목록에서 제거
7. 사용자가 휴지통 접근
8. 삭제된 할일 목록 조회
9. 복구할 할일 선택
10. 시스템이 할일을 활성 상태로 복원
11. 할일 목록에 다시 표시

**대안 흐름**:
- 2a. 공통 일정 삭제 시도: 삭제 불가 메시지 표시
- 9a. 영구 삭제 선택: 확인 후 데이터베이스에서 완전 삭제

**사후 조건**: 할일이 휴지통으로 이동하거나 복구됨

---

### 5.4 UC-004: 공통 일정 조회

**액터**: 로그인한 사용자

**사전 조건**: 사용자가 인증되고 시스템에 공통 일정이 등록됨

**주요 흐름**:
1. 사용자가 할일 목록 페이지 접근
2. 시스템이 개인 할일과 공통 일정을 통합하여 표시
3. 공통 일정이 시각적으로 구분됨 (예: 배지, 색상)
4. 사용자가 공통 일정 선택하여 상세 조회
5. 시스템이 공통 일정 정보 표시
6. 수정/삭제 옵션이 비활성화됨

**대안 흐름**:
- 4a. 수정/삭제 시도: 권한 없음 메시지 표시

**사후 조건**: 공통 일정이 읽기 전용으로 조회됨

---

## 6. 도메인 관계도

```
┌─────────────────────────────┐
│          User               │
│        (사용자)              │
│                             │
│  - user_id                  │
│  - email                    │
│  - password (encrypted)     │
│  - role (USER/ADMIN)        │
│  - refresh_token            │
└──────────┬──────────────────┘
           │ 1
           │
           │ owns
           │
           │ N
┌──────────▼──────────────────┐         ┌──────────────────────────┐
│          Todo               │         │     PublicHoliday        │
│        (할일)                │         │      (공통 일정)          │
│                             │         │                          │
│  - todo_id                  │         │  - holiday_id            │
│  - title                    │         │  - name                  │
│  - content                  │         │  - date                  │
│  - start_date               │         │  - type                  │
│  - due_date                 │         │  - is_recurring          │
│  - is_completed             │         │  - created_by (ADMIN)    │
│  - priority (1,2,3)         │         │                          │
│  - owner_id (FK → User)     │         └──────────────────────────┘
│  - deleted_status           │                    │
│    (ACTIVE/DELETED)         │                    │
└─────────────────────────────┘                    │
           │                                       │
           │                                       │
    휴지통: deleted_status='DELETED'                │
    활성: deleted_status='ACTIVE'                   │
                                                    │
                                                    ▼
                                   모든 인증된 사용자가 조회 가능
                                   ROLE_ADMIN만 생성/수정/삭제
```

**설계 원칙**:
- Todo와 PublicHoliday는 독립된 테이블
- RecycleBin은 별도 테이블이 아닌 Todo의 deleted_status로 구현
- User 역할(role)로 권한 제어

---

## 7. 비즈니스 용어 정의

| 용어 | 정의 | 비고 |
|------|------|------|
| 할일 (Todo) | 사용자가 완료해야 하는 작업 항목 | 개인 할일만 해당 |
| 공통 일정 (PublicHoliday) | 시스템에서 관리하는 공유 일정 | 국경일, 공휴일, 기념일 등 |
| 만료 일시 (Due Date) | 할일을 완료해야 하는 마감 시간 | 시작 일시보다 이후 |
| 완료 상태 | 할일의 완료 여부를 나타내는 플래그 | true/false |
| 휴지통 | 삭제된 할일의 임시 보관소 | deleted_status='DELETED' 상태 |
| 소프트 삭제 | 데이터를 물리적으로 삭제하지 않고 상태 변경 | deleted_status='DELETED' 설정 |
| 영구 삭제 | 데이터베이스에서 완전히 제거 | 복구 불가, 백업만 가능 |
| Access Token | 인증된 사용자의 API 접근 권한 토큰 | 유효 기간 15분, JWT 형식 |
| Refresh Token | Access Token 재발급을 위한 토큰 | 유효 기간 7일, 일회용 |
| ROLE_USER | 일반 사용자 역할 | 자신의 할일 관리 권한 |
| ROLE_ADMIN | 관리자 역할 | 공통 일정 관리 권한 + 일반 사용자 권한 |
| 우선순위 (Priority) | 할일의 중요도 | LOW(1), MEDIUM(2), HIGH(3) |
| 삭제 상태 (Deleted Status) | 할일의 삭제 여부를 나타내는 상태 | ACTIVE 또는 DELETED |

---

## 8. 제약사항 및 가정

### 8.1 비즈니스 제약사항

**CONST-001**: 인증 필수
- 모든 할일 관리 기능은 인증된 사용자만 접근 가능
- 미인증 사용자는 로그인/회원가입 페이지만 접근

**CONST-002**: 데이터 격리
- 사용자는 자신의 할일만 조회/수정/삭제 가능
- 타 사용자의 할일 접근 시도 시 403 Forbidden

**CONST-003**: 공통 일정 보호
- 일반 사용자(ROLE_USER)는 공통 일정 조회만 가능
- 공통 일정 생성/수정/삭제는 ROLE_ADMIN만 가능

**CONST-004**: 데이터 복구
- 삭제된 할일은 휴지통을 통해 복구 가능 (소프트 삭제)
- 영구 삭제된 할일은 백업 외 복구 불가

**CONST-005**: 토큰 갱신 제한
- Refresh Token은 일회용 (사용 시 새 토큰 발급)
- 동일한 Refresh Token 재사용 시도 시 모든 토큰 무효화 (보안)

---

### 8.2 가정사항

**ASSUME-001**: 사용자 환경
- 사용자는 유효한 이메일 주소 보유
- 모던 웹 브라우저 사용 (Chrome, Firefox, Safari, Edge 최신 2개 버전)
- HTTPS 접속 가능

**ASSUME-002**: 공통 일정 관리
- 초기에는 관리자가 수동으로 국경일 등록
- 매년 자동 생성 기능은 Phase 2 이후 구현

**ASSUME-003**: 휴지통 정책
- MVP에서는 무기한 보관
- 자동 삭제 정책은 운영 데이터 확보 후 Phase 2에서 검토

**ASSUME-004**: 동시 접속
- 초기 목표: 동시 100명 사용자 지원
- 트래픽 증가 시 수평 확장 대응

**ASSUME-005**: 데이터 백업
- 일 1회 데이터베이스 백업
- 백업 보관 기간: 30일

---

### 8.3 기술 제약사항

**TECH-001**: 데이터베이스
- 관계형 데이터베이스 사용 (PostgreSQL 또는 MySQL)
- 트랜잭션 지원 필수

**TECH-002**: 보안
- HTTPS 필수 (프로덕션 환경)
- 비밀번호 평문 저장 금지
- JWT Secret Key 환경 변수 관리

**TECH-003**: API 설계
- RESTful API 원칙 준수
- JSON 형식 요청/응답
- HTTP 상태 코드 표준 준수

---

## 9. 성공 지표

### 9.1 MVP 성공 기준

| 지표 | 목표 | 측정 방법 | 측정 시점 |
|------|------|----------|----------|
| 기능 완성도 | 100% MVP 기능 구현 | 기능 체크리스트 | MVP 완료 시 |
| 버그 발생률 | 치명적 버그 0건 | 버그 트래킹 시스템 | 출시 전 |
| API 응답 시간 | P95 < 500ms | 성능 모니터링 도구 | 출시 전 |
| 단위 테스트 커버리지 | 70% 이상 | 코드 커버리지 도구 | 출시 전 |

---

### 9.2 운영 성공 지표 (출시 후 3개월)

| 지표 | 목표 | 측정 방법 | 측정 주기 |
|------|------|----------|----------|
| 사용자 등록 | 최소 30명 | 신규 사용자 수 추적 | 월간 |
| 일일 활성 사용자 (DAU) | 등록 사용자의 40% | UTC 0시 기준 24시간 내 로그인한 고유 사용자 | 일간 |
| 할일 생성률 | 사용자당 평균 3개/주 | 주간 할일 생성 수 / 활성 사용자 수 | 주간 |
| 완료율 | 생성 후 7일 내 60% 이상 완료 | (최근 7일 내 완료된 할일) / (최근 7일 내 생성된 할일) × 100 | 주간 |
| 휴지통 복구율 | 삭제 할일의 15% 이상 복구 | (복구된 할일 수) / (삭제된 할일 수) × 100 | 월간 |
| 시스템 가용성 | 99% 이상 | 가동 시간 / 전체 시간 × 100 | 월간 |

**참고**:
- 목표 수치는 초기 예상값이며, 3개월 운영 데이터를 기반으로 조정
- MVP 단계에서는 기능 완성도와 안정성에 우선순위

---

## 10. 우선순위 및 범위

### 10.1 MVP (최소 기능 제품) 범위

**인증 및 사용자 관리**:
- 회원가입 (이메일, 비밀번호)
- 로그인 (JWT Access Token + Refresh Token)
- 로그아웃

**할일 관리 (ROLE_USER)**:
- 할일 생성 (제목, 내용, 시작/만료 일시, 우선순위)
- 할일 목록 조회 (본인 할일만)
- 할일 상세 조회
- 할일 수정
- 할일 완료/취소 처리
- 할일 삭제 (소프트 삭제)

**휴지통 관리**:
- 휴지통 조회 (삭제된 할일 목록)
- 할일 복구
- 할일 영구 삭제

**공통 일정 관리 (ROLE_ADMIN)**:
- 공통 일정 생성
- 공통 일정 수정
- 공통 일정 삭제
- 공통 일정 조회 (모든 사용자)

**필터링 및 정렬 (기본)**:
- 완료/미완료 필터
- 우선순위별 정렬
- 만료 일시별 정렬

---

### 10.2 Phase 2 (향후 확장 - 우선순위 낮음)
1. 만료 임박 알림 (이메일, 푸시 알림)
2. 태그 및 카테고리
3. 할일 검색 기능
4. 통계 및 리포트 (완료율, 생산성 지표)
5. 관리자 대시보드 (사용자 관리, 시스템 모니터링)

---

### 10.3 Phase 3 (향후 확장 - 우선순위 매우 낮음)
1. 할일 공유 기능 (다른 사용자와 협업)
2. 반복 일정 (매일, 매주, 매월)
3. 모바일 앱 (iOS, Android)
4. 브라우저 및 IP 로깅
5. QR 코드 위치 인증

**참고**: Phase 2, 3는 MVP 완성 후 사용자 피드백에 따라 우선순위 재조정

---

## 11. 리스크 및 완화 전략

| 리스크 | 영향도 | 확률 | 완화 전략 | 책임자 |
|--------|--------|------|----------|--------|
| JWT 토큰 탈취 | 높음 | 중간 | - 짧은 Access Token 만료 시간 (15분)<br>- HTTPS 필수<br>- Refresh Token 일회용 정책 | 백엔드 개발자 |
| 사용자 데이터 유출 | 높음 | 낮음 | - 비밀번호 bcrypt 암호화<br>- SQL Injection 방지 (ORM 사용)<br>- XSS 방지 (입력값 이스케이프) | 백엔드 개발자 |
| 휴지통 데이터 과다 축적 | 중간 | 중간 | - 초기에는 무제한 보관<br>- Phase 2에서 자동 삭제 정책 검토 (예: 30일 후 자동 영구 삭제) | Product Owner |
| 만료 일시 검증 오류 | 낮음 | 중간 | - 프론트엔드 + 백엔드 이중 검증<br>- 단위 테스트 작성<br>- 에러 메시지 명확화 | 풀스택 개발자 |
| 공통 일정 미등록 | 중간 | 높음 | - MVP에 관리자 기능 포함<br>- 초기 주요 국경일 수동 등록 | Product Owner |

**참고**: MVP 단계에서는 기본 기능에 집중하고, 복잡한 리스크 대응은 Phase 2 이후 검토

---

## 12. 다음 단계

1. **요구사항 검토**: 이해관계자와 도메인 정의서 검토 및 승인
2. **데이터 모델링**: ERD(Entity Relationship Diagram) 상세 설계
3. **API 설계**: RESTful API 엔드포인트 정의
4. **UI/UX 설계**: 화면 흐름도 및 와이어프레임 작성
5. **개발 계획**: 스프린트 계획 및 백로그 구성
6. **기술 스택 확정**: 아키텍처 및 기술 선정
7. **개발 착수**: MVP 개발 시작

---

## 13. 비기능적 요구사항 (Non-Functional Requirements)

### 13.1 성능 요구사항

**NFR-PERF-001**: API 응답 시간
- 할일 목록 조회: P95 < 300ms, P99 < 500ms
- 할일 생성/수정: P95 < 200ms
- 로그인/토큰 발급: P95 < 500ms

**NFR-PERF-002**: 동시 사용자
- 최소 100명 동시 사용자 지원
- 향후 1,000명까지 확장 대비

**NFR-PERF-003**: 데이터베이스 쿼리
- 단일 쿼리 실행 시간: 평균 < 50ms
- N+1 쿼리 문제 회피 (Eager Loading 활용)

---

### 13.2 보안 요구사항

**NFR-SEC-001**: HTTPS 필수
- 모든 API 통신은 HTTPS 사용
- HTTP 요청 시 HTTPS로 자동 리다이렉트

**NFR-SEC-002**: 비밀번호 보안
- bcrypt 알고리즘, 최소 10 rounds
- 비밀번호 평문 저장 금지
- 비밀번호는 응답에 절대 포함하지 않음

**NFR-SEC-003**: JWT 토큰 보안
- Secret Key는 환경 변수로 관리 (최소 256bit)
- Access Token은 Authorization Bearer 헤더로 전송
- Refresh Token은 httpOnly 쿠키 또는 안전한 저장소 사용

**NFR-SEC-004**: SQL Injection 방지
- ORM/Query Builder 사용 (Sequelize, TypeORM 등)
- 동적 쿼리 생성 시 파라미터 바인딩 필수

**NFR-SEC-005**: XSS 방지
- 사용자 입력값 HTML 이스케이프 처리
- Content-Security-Policy 헤더 설정

---

### 13.3 가용성 요구사항

**NFR-AVAIL-001**: 목표 가동 시간
- 99% 가용성 목표 (월 약 7.2시간 다운타임 허용)
- 계획된 유지보수: 주 1회, 최대 1시간

**NFR-AVAIL-002**: 장애 복구
- 데이터베이스 백업: 일 1회
- 복구 시간 목표(RTO): 4시간 이내
- 복구 시점 목표(RPO): 24시간 이내

**NFR-AVAIL-003**: 에러 처리
- 500 Internal Server Error 발생 시 로깅
- 사용자에게 친화적인 에러 메시지 제공
- 에러 추적 시스템 구축 (Sentry 등)

---

### 13.4 확장성 요구사항

**NFR-SCALE-001**: 수평 확장
- 애플리케이션 서버 무상태(Stateless) 설계
- JWT 기반 인증으로 서버 간 세션 공유 불필요

**NFR-SCALE-002**: 데이터베이스 확장
- 읽기 복제본(Read Replica) 구성 대비
- 인덱스 최적화 (user_id, deleted_status, created_at 등)

**NFR-SCALE-003**: 파일 저장소
- 향후 이미지/파일 업로드 시 클라우드 스토리지 활용 (S3 등)

---

### 13.5 유지보수성 요구사항

**NFR-MAINT-001**: 코드 품질
- ESLint/Prettier를 통한 코드 스타일 통일
- 단위 테스트 커버리지 최소 70%

**NFR-MAINT-002**: 로깅
- 모든 API 요청/응답 로깅
- 에러 발생 시 스택 트레이스 기록
- 로그 레벨: DEBUG, INFO, WARN, ERROR

**NFR-MAINT-003**: 문서화
- API 문서 자동 생성 (Swagger/OpenAPI)
- README에 개발 환경 설정 가이드 포함

---

## 14. 아키텍처 결정 기록 (Architecture Decision Records)

### ADR-001: 공통 일정 저장 방식

**상태**: 승인됨 (Accepted)

**결정 일자**: 2025-11-25

**컨텍스트**:
- 공통 일정(PublicHoliday)을 Todo 테이블에 포함할지, 별도 테이블로 분리할지 결정 필요
- 공통 일정은 모든 사용자에게 표시되지만, 개인 할일과는 다른 생명주기와 권한 모델을 가짐

**결정**:
PublicHoliday를 독립된 테이블로 구현

**이유**:
1. 생명주기 차이: 공통 일정은 삭제되지 않고, 매년 반복되는 특성
2. 권한 모델 차이: 공통 일정은 ROLE_ADMIN만 수정 가능
3. 쿼리 성능: 개인 할일과 공통 일정을 분리하여 인덱스 최적화 가능
4. 확장성: 향후 공통 일정만의 특수 속성 추가 용이

**결과**:
- Todo와 PublicHoliday를 별도로 조회 후 애플리케이션 레벨에서 통합
- 데이터베이스 정규화 향상
- 쿼리 복잡도 소폭 증가 (허용 가능)

---

### ADR-002: 인증 방식

**상태**: 승인됨 (Accepted)

**결정 일자**: 2025-11-25

**컨텍스트**:
- 세션 기반 인증 vs JWT 기반 인증 선택 필요
- 확장성과 마이크로서비스 전환 가능성 고려

**결정**:
JWT(JSON Web Token) 기반 인증 사용

**이유**:
1. Stateless: 서버 간 세션 공유 불필요, 수평 확장 용이
2. 마이크로서비스 친화적: 향후 서비스 분리 시 유리
3. 모바일 앱 대응: 향후 모바일 앱 개발 시 동일한 인증 메커니즘 사용 가능
4. CORS 문제 최소화: 쿠키 기반 세션보다 CORS 처리 간단

**결과**:
- Access Token (15분) + Refresh Token (7일) 구조
- Refresh Token은 데이터베이스에 저장하여 강제 로그아웃 가능
- Secret Key는 환경 변수로 관리

**트레이드오프**:
- Refresh Token 관리를 위한 데이터베이스 저장 필요
- 토큰 탈취 시 만료 전까지 사용 가능 (짧은 만료 시간으로 완화)

---

### ADR-003: 삭제 메커니즘

**상태**: 승인됨 (Accepted)

**결정 일자**: 2025-11-25

**컨텍스트**:
- 휴지통 기능을 별도 테이블로 구현할지, Todo 테이블의 플래그로 관리할지 결정 필요

**결정**:
Todo 테이블의 deleted_status 컬럼으로 소프트 삭제 구현

**이유**:
1. 단순성: 별도 테이블 없이 단일 테이블로 관리
2. 참조 무결성: 외래 키 관계 유지 용이
3. 쿼리 효율: 인덱스를 통한 빠른 조회 (deleted_status + user_id)
4. 복구 용이: 단순히 플래그 변경으로 복구 가능

**결과**:
- Todo.deleted_status: 'ACTIVE' | 'DELETED'
- 휴지통 조회: WHERE deleted_status = 'DELETED'
- 할일 목록 조회: WHERE deleted_status = 'ACTIVE'
- 영구 삭제: DELETE FROM todos WHERE ...

**트레이드오프**:
- 영구 삭제된 할일은 복구 불가 (백업으로 대응)

---

### ADR-004: 우선순위 표현 방식

**상태**: 승인됨 (Accepted)

**결정 일자**: 2025-11-25

**컨텍스트**:
- 우선순위를 문자열('LOW', 'MEDIUM', 'HIGH')로 저장할지, 숫자(1, 2, 3)로 저장할지 결정 필요

**결정**:
숫자로 저장 (LOW=1, MEDIUM=2, HIGH=3)

**이유**:
1. 정렬 용이: ORDER BY priority DESC로 간단히 정렬
2. 저장 공간 효율: INTEGER가 VARCHAR보다 저장 공간 작음
3. 확장 가능: 향후 우선순위 레벨 추가 시 숫자 증가로 대응
4. 인덱스 효율: 숫자 인덱스가 문자열보다 효율적

**결과**:
- 데이터베이스: priority INTEGER (1, 2, 3)
- API 응답: priority 문자열로 변환 ("LOW", "MEDIUM", "HIGH")
- 프론트엔드: Enum 또는 상수로 매핑

---

## 15. 시스템 설정값

| 설정 키 | 값 | 설명 | 변경 가능 여부 |
|---------|-----|------|--------------|
| JWT_ACCESS_TOKEN_EXPIRY | 15분 | Access Token 유효 기간 | Yes |
| JWT_REFRESH_TOKEN_EXPIRY | 7일 | Refresh Token 유효 기간 | Yes |
| PASSWORD_MIN_LENGTH | 8 | 최소 비밀번호 길이 | No (보안 정책) |
| PASSWORD_BCRYPT_ROUNDS | 10 | bcrypt 암호화 rounds | No (보안 정책) |
| TODO_TITLE_MAX_LENGTH | 200 | 할일 제목 최대 길이 | Yes |
| TODO_CONTENT_MAX_LENGTH | 2000 | 할일 내용 최대 길이 | Yes |
| EMAIL_MAX_LENGTH | 100 | 이메일 최대 길이 | No |

---

**문서 버전**: 2.0
**작성일**: 2025-11-25
**최종 수정일**: 2025-11-25
**작성자**: Business Analyst
**상태**: 승인 대기 (Pending Approval)

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 2.0 | 2025-11-25 | - 요구사항 식별자 체계 도입 (REQ-XXX-NNN)<br>- 비기능적 요구사항 추가<br>- ADR(아키텍처 결정 기록) 추가<br>- 관리자 역할 명확화<br>- JWT 토큰 정책 상세화<br>- PublicHoliday 설계 결정<br>- 삭제 메커니즘 명확화 | Business Analyst |
| 1.0 | 2025-11-25 | 초기 문서 작성 | Business Analyst |
